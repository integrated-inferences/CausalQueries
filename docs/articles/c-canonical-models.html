<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Canonical causal models • CausalQueries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Canonical causal models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CausalQueries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/b-plotting.html">Plotting models</a></li>
    <li><a class="dropdown-item" href="../articles/c-canonical-models.html">Canonical causal models</a></li>
    <li><a class="dropdown-item" href="../articles/d-front-door.html">Through the front door</a></li>
    <li><a class="dropdown-item" href="../articles/e-posteriors.html">Inspecting posteriors</a></li>
    <li><a class="dropdown-item" href="../articles/f-complier-profiling.html">Profiling compliers and non-compliers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/integrated-inferences/CausalQueries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Canonical causal models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/integrated-inferences/CausalQueries/blob/HEAD/vignettes/c-canonical-models.Rmd" class="external-link"><code>vignettes/c-canonical-models.Rmd</code></a></small>
      <div class="d-none name"><code>c-canonical-models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://integrated-inferences.github.io/CausalQueries/">CausalQueries</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/estimatr/" class="external-link">estimatr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Here we show properties of some canonical causal models, exploring in
particular estimates of non-identified queries. The examples include
cases where inferences are reliable but also where identification
failures result in unreliable posteriors.</p>
<div class="section level2">
<h2 id="simple-experiment">Simple experiment<a class="anchor" aria-label="anchor" href="#simple-experiment"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"X -&gt; Y"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="csimple-1.png" alt="Simple experiment" width="50%"><p class="caption">
Simple experiment
</p>
</div>
<p>This model could be justified by a randomized control trial. With a
lot of data you can get tight estimates for the effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
but not for whether a given outcome on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is due to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
That is the “effects of causes” estimand is identified, but the “causes
of effects” estimand is not.</p>
<p>In the illustration below we generate data from a parameterized model
and then try to recover the average treatment effect (ATE) and the
“probability of causation” (POC) for <code>X=1, Y=1</code> cases. The
ATE has a tight credibility interval. The PoC does not, although it is
still considerably tighter than the prior.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10"</span>, <span class="st">"01"</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span>queries <span class="op">=</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ATE <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>                     POC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span><span class="op">)</span>,</span>
<span>              using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"priors"</span>, <span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="csimpleq-1.png" alt="Simple experiment query"><div class="figcaption">Simple experiment query</div>
</div>
</div>
<div class="section level2">
<h2 id="confounded">Confounded<a class="anchor" aria-label="anchor" href="#confounded"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"X -&gt; Y; X &lt;-&gt; Y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x_coord <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, y_coord <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="cconfounded-1.png" alt="Confounded model" width="75%"><p class="caption">
Confounded model
</p>
</div>
<p>This is the appropriate model if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
is not randomized and it is possible that unknown factors affect both
the assignment of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and the outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<p>In the illustration below we use data, drawn from a model in which
<em>X</em> is <em>in fact</em> as if randomized (though we do not know
this) and there is a true positive treatment effect. We see we have lost
identification on the ATE but also our uncertainty about POC is much
greater.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="st">"01"</span>, parameters <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span>queries <span class="op">=</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ATE <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>                     POC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span><span class="op">)</span>,</span>
<span>              using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"priors"</span>, <span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cconfoundedq-1.png" alt="Confounded model query"><div class="figcaption">Confounded model query</div>
</div>
</div>
<div class="section level2">
<h2 id="chain-model">Chain model<a class="anchor" aria-label="anchor" href="#chain-model"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="cchain-1.png" alt="Chain model" width="75%"><p class="caption">
Chain model
</p>
</div>
<p>This is a chain model. This model is hard to justify from
experimentation since randomization of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
does not guarantee that third features do not influence both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
or that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
operates on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
only though
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.</p>
<p>Even still, it is a good model to illustrate limits of learning about
effects by observation of the values of mediators.</p>
<p>Below we imagine that data is produced by a model in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
has a 0.8 average effect on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
has a 0.8 average effect on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
We see that positive evidence on the causal chain (on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>)
has a modest effect on our belief that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Z=1</annotation></semantics></math>
caused
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y=1</annotation></semantics></math>.
Negative evidence has a much stronger effect, albeit with considerable
posterior uncertainty.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X.10"</span>, <span class="st">"X.01"</span>, <span class="st">"Y.10"</span>, <span class="st">"Y.01"</span><span class="op">)</span>,</span>
<span>                 parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.85</span>, <span class="fl">.05</span>, <span class="fl">.85</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span>query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Y[Z=1] - Y[Z=0]"</span><span class="op">)</span>,</span>
<span>              given <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"Z==1 &amp; Y==1"</span>, <span class="st">"Z==1 &amp; Y==1 &amp; X==0"</span>, <span class="st">"Z==1 &amp; Y==1 &amp; X==1"</span><span class="op">)</span>,</span>
<span>              using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cchainq-1.png" alt="Chain model query"><div class="figcaption">Chain model query</div>
</div>
</div>
<div class="section level2">
<h2 id="iv-model-with-exclusion-restriction">IV model with exclusion restriction<a class="anchor" aria-label="anchor" href="#iv-model-with-exclusion-restriction"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model with exclusion restriction and monotonicity</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y; X &lt;-&gt; Y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_restrictions.html">set_restrictions</a></span><span class="op">(</span><span class="fu"><a href="../reference/query_helpers.html">decreasing</a></span><span class="op">(</span><span class="st">'Z'</span>, <span class="st">'X'</span><span class="op">)</span><span class="op">)</span>  <span class="co"># monotonicity restriction</span></span>
<span></span>
<span></span>
<span><span class="co"># Adding parameters for data generation</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y.10_X.01"</span>, <span class="st">"Y.01_X.01"</span><span class="op">)</span>,</span>
<span>                 parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.75</span><span class="op">)</span><span class="op">)</span>     <span class="co"># complier effect</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, y_coord <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="civ-1.png" alt="IV model with exclusion restriction satisfied" width="75%"><p class="caption">
IV model with exclusion restriction satisfied
</p>
</div>
<p>This is the classic “instrumental variables” model. This model is
sometimes justified by randomization of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
under the assumption that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
operates on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
only though
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
(the exclusion restriction). Researchers also often assume that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
has a monotonic effect on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
which we have also imposed here.</p>
<p>Below we draw data from this model, update, and query, focusing our
attention on the effects of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
for the population and also specifically for units for whom
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
responds positively to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
compliers. In addition we ask about the probability of causation, both
for units with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X=1, Y=1</annotation></semantics></math>
(PoC) and for compliers with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X=1, Y=1</annotation></semantics></math>
(PoCC). In the model that generated these data an effect is present for
compliers only, though researchers do not know (or assume) this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span><span class="va">model</span>, <span class="fl">4000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ATE <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>      LATE<span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X[Z=1] &gt; X[Z=0]"</span>, <span class="co"># ATE for compliers</span></span>
<span>      PoC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span>,    <span class="co"># ATE for units with X=Y-1</span></span>
<span>      PoCC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1 &amp; (X[Z=1] &gt; X[Z=0])"</span><span class="op">)</span>,    <span class="co"># ATE for units with X=Y-1</span></span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span>, <span class="st">"parameters"</span><span class="op">)</span>,</span>
<span>    cred <span class="op">=</span> <span class="fl">99</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="civq1-1.png" alt="IV inferences I"><div class="figcaption">IV inferences I</div>
</div>
<p>Note the relatively tight posterior for the complier average effect
(LATE) and the wide posterior for the average effect and for the
probability of causation.</p>
</div>
<div class="section level2">
<h2 id="iv-model-without-exclusion-restriction">IV model without exclusion restriction<a class="anchor" aria-label="anchor" href="#iv-model-without-exclusion-restriction"></a>
</h2>
<p>Here is a model in which neither the exclusion restriction or
monotonicity holds.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y &lt;- Z; X &lt;-&gt; Y"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, y_coord <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="civ2-1.png" alt="Exclusion restriction not satisfied" width="75%"><p class="caption">
Exclusion restriction not satisfied
</p>
</div>
<p>Note that for comparability we assume again that the data is the same
as before, generated by a model in which the exclusion restriction in
fact holds (though researchers do not know this).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ATE <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>      LATE<span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X[Z=1] &gt; X[Z=0]"</span>, <span class="co"># ATE for compliers</span></span>
<span>      PoC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span>,    <span class="co"># ATE for units with X=Y-1</span></span>
<span>      PoCC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1 &amp; (X[Z=1] &gt; X[Z=0])"</span><span class="op">)</span>, <span class="co"># ATE for compliers with X=Y-1</span></span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span><span class="op">)</span>,</span>
<span>    cred <span class="op">=</span> <span class="fl">99</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="civq2-1.png" alt="IV inferences II"><div class="figcaption">IV inferences II</div>
</div>
<p>We updated here using a relatively large number of iterations to
ensure stable estimates. Note the failure of the two key assumptions are
reflected by larger credibility intervals and underestimates for all
quantities.</p>
</div>
<div class="section level2">
<h2 id="mediation-model-with-sequential-ignorability">Mediation model with sequential ignorability<a class="anchor" aria-label="anchor" href="#mediation-model-with-sequential-ignorability"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y &lt;- Z"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, y_coord <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="cmed-1.png" alt="Mediation model with sequential ignorability satisfied" width="75%"><p class="caption">
Mediation model with sequential ignorability satisfied
</p>
</div>
<p>This is a typical mediation type problem where you might want to
understand the effects of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
that operate directly or that operate via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.</p>
<p>We have assumed here that there are no third features that cause both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
This is a strong assumption that is a key part of “sequential
ignorability” (see Forastiere et al (2018) for an extensive treatment of
the relationship between sequential ignorability and “strong principal
ignorability” which we impose here).</p>
<p>Here one might ask queries about different types of direct or
indirect effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
as well as the average effects of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
and of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<p>In this example the data is drawn from a world in which the most
common type has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y=1</annotation></semantics></math>
if and only if both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Z=1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X=1</annotation></semantics></math>
but in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
exerts a negative effect on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>;
there are both positive direct effects and negative indirect
effects.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y &lt;- Z"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"00"</span>, <span class="st">"10"</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="st">"0001"</span>, parameters <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">queries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  `ATE Z -&gt; X` <span class="op">=</span> <span class="st">"X[Z=1] - X[Z=0]"</span>,</span>
<span>  `ATE Z -&gt; Y` <span class="op">=</span> <span class="st">"Y[Z=1] - Y[Z=0]"</span>,</span>
<span>  `ATE X -&gt; Y` <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>  `Direct (Z=1)` <span class="op">=</span> <span class="st">"Y[Z = 1, X = X[Z=1]] - Y[Z = 0, X = X[Z=1]]"</span>,</span>
<span>  `Direct (Z=0)` <span class="op">=</span> <span class="st">"Y[Z = 1, X = X[Z=0]] - Y[Z = 0, X = X[Z=0]]"</span>,</span>
<span>  `Indirect (Z=1)` <span class="op">=</span> <span class="st">"Y[Z = 1, X = X[Z=1]] - Y[Z = 1, X = X[Z=0]]"</span>,</span>
<span>  `Indirect (Z=0)` <span class="op">=</span> <span class="st">"Y[Z = 0, X = X[Z=1]] - Y[Z = 0, X = X[Z=0]]"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    query <span class="op">=</span> <span class="va">queries</span>,</span>
<span>    cred <span class="op">=</span> <span class="fl">99</span>,</span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cmedq-1.png" alt="Mediation model query"><div class="figcaption">Mediation model query</div>
</div>
<p>We estimate all quantities very well.</p>
</div>
<div class="section level2">
<h2 id="mediation-model-without-sequential-ignorability">Mediation model without sequential ignorability<a class="anchor" aria-label="anchor" href="#mediation-model-without-sequential-ignorability"></a>
</h2>
<p>We now allow that there may be third features that cause both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
Thus we do not assume “sequential ignorability.” This model might be
justified by a random assignment of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.</p>
<p>In this example the data is drawn the same way as before which means
that in the data generating model the potential outcomes for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
are independent of those for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
though the researcher does not know this. The true (unknown) values of
the queries are also the same as before.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z -&gt; X -&gt; Y &lt;- Z; X &lt;-&gt; Y"</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"00"</span>, <span class="st">"10"</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>nodal_type <span class="op">=</span> <span class="st">"0001"</span>, parameters <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, y_coord <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cmed2-1.png" alt="Mediation model without sequential ignorability"><div class="figcaption">Mediation model without sequential
ignorability</div>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="va">model</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    query <span class="op">=</span> <span class="va">queries</span>,</span>
<span>    cred <span class="op">=</span> <span class="fl">99</span>,</span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"posteriors"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cmed2q-1.png" alt="Querying mediation model without sequential ignorability"><div class="figcaption">Querying mediation model without sequential
ignorability</div>
</div>
<p>We see we do not do nearly so well. To ensure stable estimates we ran
a large number of iterations. For the non-identified quantities our
credibility intervals are not tight (which is as it should be!) and in
one case the true value lies outside of them (which is not as it should
be). This highlights the extreme difficulty of this problem.
Nevertheless the gains relative to the priors are considerable.</p>
</div>
<div class="section level2">
<h2 id="the-napkin-model">The napkin model<a class="anchor" aria-label="anchor" href="#the-napkin-model"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"W-&gt;Z-&gt;X-&gt;Y; W &lt;-&gt; X; W &lt;-&gt; Y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cnap-1.png" alt="Napkin model"><div class="figcaption">Napkin model</div>
</div>
<p>The “napkin” model (see Pearl’s <em>Book of Why</em>) involves two
types of confounding. We will paramaterize a version in which (a) the
average causal effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is negative, arising in cases when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">W=0</annotation></semantics></math>
(b) there is positive confounding arising from the fact that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
is liable to be 1 regardless of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">W = 1</annotation></semantics></math>
and )
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is liable to be 1 regardless of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">W = 1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"Y.10_W.0"</span>, parameters <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"Y.11_W.1"</span>, parameters <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"X.11_W.1"</span>, parameters <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span></code></pre></div>
<p>Naive regression performs very badly here.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span><span class="va">model</span>, n <span class="op">=</span> <span class="fl">5000</span>, using <span class="op">=</span> <span class="st">"parameters"</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">estimatr</span><span class="fu">::</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html" class="external-link">lm_robust</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="11%">
<col width="12%">
<col width="12%">
<col width="9%">
<col width="11%">
<col width="12%">
<col width="6%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="right">df</th>
<th align="left">outcome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.75</td>
<td align="right">0.01</td>
<td align="right">66.39</td>
<td align="right">0</td>
<td align="right">0.73</td>
<td align="right">0.78</td>
<td align="right">4998</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">X</td>
<td align="right">-0.05</td>
<td align="right">0.01</td>
<td align="right">-3.63</td>
<td align="right">0</td>
<td align="right">-0.08</td>
<td align="right">-0.02</td>
<td align="right">4998</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>In contrast, the updated causal model yields good estimates for the
ATE, though again we have somewhat more uncertainty for the probability
of causation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      ATE <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>      PoC <span class="op">=</span> <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span><span class="op">)</span>,</span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span>, <span class="st">"priors"</span>, <span class="st">"parameters"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cnapq-1.png" alt="Napkin model queries"><div class="figcaption">Napkin model queries</div>
</div>
</div>
<div class="section level2">
<h2 id="m-bias">
<em>M</em>-bias<a class="anchor" aria-label="anchor" href="#m-bias"></a>
</h2>
<p>In the below model, also studied in Pearl (<em>Causality</em>), the
effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is identified without controlling for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.
Controlling for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
however, introduces a backdoor path between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
which can introduce bias in naive estimation.</p>
<p>Strikingly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
might be prior to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
but it can still introduce bias. Here is the model</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span><span class="st">"Z &lt;- U1 -&gt; Y; Z &lt;- U2 -&gt; X; X -&gt; Y"</span><span class="op">)</span></span></code></pre></div>
<p>Here is a parameterization in which there is no true effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
yet a strong negative correlation between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
once you control for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"Y.0101"</span>, parameters <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"Z.0001"</span>, parameters <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/parameter_setting.html">set_parameters</a></span><span class="op">(</span>param_name <span class="op">=</span> <span class="st">"X.01"</span>, parameters <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cmbias-1.png" alt="M bias model"><div class="figcaption">M bias model</div>
</div>
<p>With this model, naive regression results perform poorly when you
control for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/data_helpers.html">make_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  `no controls` <span class="op">=</span> <span class="fu">estimatr</span><span class="fu">::</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html" class="external-link">lm_robust</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>,</span>
<span>  `with controls` <span class="op">=</span> <span class="fu">estimatr</span><span class="fu">::</span><span class="fu"><a href="https://declaredesign.org/r/estimatr/reference/lm_robust.html" class="external-link">lm_robust</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tidy</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span><span class="st">"X"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span>, caption <span class="op">=</span> <span class="st">"Estimation with and without controls"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Estimation with and without controls</caption>
<colgroup>
<col width="16%">
<col width="5%">
<col width="10%">
<col width="11%">
<col width="11%">
<col width="9%">
<col width="10%">
<col width="11%">
<col width="4%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="right">df</th>
<th align="left">outcome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">no controls</td>
<td align="left">X</td>
<td align="right">0.04</td>
<td align="right">0.03</td>
<td align="right">1.32</td>
<td align="right">0.19</td>
<td align="right">-0.02</td>
<td align="right">0.10</td>
<td align="right">998</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">with controls</td>
<td align="left">X</td>
<td align="right">-0.11</td>
<td align="right">0.03</td>
<td align="right">-3.48</td>
<td align="right">0.00</td>
<td align="right">-0.18</td>
<td align="right">-0.05</td>
<td align="right">997</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>Taking account of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
does not harm (and could help) in the Bayesian setting.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  `Using Z` <span class="op">=</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>,</span>
<span>  `Ignoring Z` <span class="op">=</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Z</span><span class="op">)</span>, iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"Y[X=1] - Y[X=0]"</span>,</span>
<span>      <span class="st">"Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1"</span><span class="op">)</span>,</span>
<span>    using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parameters"</span>, <span class="st">"priors"</span>,  <span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="cmbiasq-1.png" alt="Querying a model with M bias"><div class="figcaption">Querying a model with M bias</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Forastiere, Laura, Alessandra Mattei, and Peng Ding. 2018. “Principal
ignorability in mediation analysis: through and beyond sequential
ignorability.” <em>Biometrika</em> 105.4: 979-986.</p>
<p>Pearl, Judea. 2012. <em>Causality</em>. Cambridge University
Press</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Macartan Humphreys, Till Tietz, Alan Jacobs, Lily Medina, Georgiy Syunyaev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
