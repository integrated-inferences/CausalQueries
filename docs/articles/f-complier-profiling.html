<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Profiling compliers and non-compliers • CausalQueries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Profiling compliers and non-compliers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CausalQueries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/b-plotting.html">Plotting models</a></li>
    <li><a class="dropdown-item" href="../articles/c-canonical-models.html">Canonical causal models</a></li>
    <li><a class="dropdown-item" href="../articles/d-front-door.html">Through the front door</a></li>
    <li><a class="dropdown-item" href="../articles/e-posteriors.html">Inspecting posteriors</a></li>
    <li><a class="dropdown-item" href="../articles/f-complier-profiling.html">Profiling compliers and non-compliers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/integrated-inferences/CausalQueries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Profiling compliers and non-compliers</h1>
            <h3 data-toc-skip class="subtitle">Characterizing latent
groups in an encouragement design</h3>
                        <h4 data-toc-skip class="author">Moritz
Marbach</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/integrated-inferences/CausalQueries/blob/HEAD/vignettes/f-complier-profiling.Rmd" class="external-link"><code>vignettes/f-complier-profiling.Rmd</code></a></small>
      <div class="d-none name"><code>f-complier-profiling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://integrated-inferences.github.io/CausalQueries/">CausalQueries</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Angrist, Imbens, and Rubin (1996) demonstrate that one can
consistently estimate the local average treatment effect, LATE, (also
called the complier average treatment effect, CATE) in randomized
control trials with non-compliance. Compliers are units that comply with
the treatment assignment, i.e., they participate if assigned to the
treatment but not otherwise. In contrast, always-takers are units that
always participate, regardless of their assignment. Never-takers are
units that never participate, regardless of their assignment. Finally,
defiers do the opposite of what they are assigned to do, i.e., they
participate if assigned to the control group and do not participate if
assigned to the treatment group. Angrist, Imbens, and Rubin (1996)
highlight that to consistently estimate the LATE, randomization is not
sufficient and one also needs to assume that there are no defiers, along
with other assumptions.</p>
<p>To better understand the subpopulation one is making inferences
about, i.e., the compliers, Marbach and Hangartner (2020) suggest to
characterize the compliers and non-compliers in terms of their
covariates when analyzing experiments with non-compliance (or use
instruments in observational studies). They provide an easy-to-use
estimator for the case of a fully randomized treatment assignment (see
<a href="https://github.com/sumtxt/ivdesc" class="external-link">ivdesc</a>). Using
<code>CausalQueries</code>, we replicate their approach with data from
the JTPA study evaluating the effectiveness of an employment and
training program in the United States during the 1980s (Bloom et
al. 1997). In this field experiment, subjects were randomly assigned to
an employment training program. However, there is non-compliance: Some
subjects assigned to training decided to not participate while a small
number managed to participate despite being assigned to the control
group.</p>
<p>For this vignette, we focus on characterizing the proportion of men
among the compliers, always-takers and never-takers. We convert the
outcome (earnings) into a binary indicator encoding if subjects earn
above median and rename the relevant variables to ease the specification
of the model:</p>
<ul>
<li>
<code>Z</code>: treatment assignment,</li>
<li>
<code>D</code>: participation,</li>
<li>
<code>Y</code>: outcome,</li>
<li>
<code>X</code>: covariate.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">read_dta</a></span><span class="op">(</span><span class="st">"http://fmwww.bc.edu/repec/bocode/j/jtpa.dta"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">training</span>, <span class="va">assignmt</span>, <span class="va">earnings</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Z<span class="op">=</span><span class="va">assignmt</span>, D<span class="op">=</span><span class="va">training</span>, Y<span class="op">=</span><span class="va">earnings</span>, X<span class="op">=</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Y</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We define a classical instrumental variable model with an exclusion
restriction and the restriction that there are no defiers. While the
exclusion restriction follows from the experimental design, the
restriction of no defiers remains an (untestable) assumption. We allow
race to confound treatment and outcome and we allow for additional
unobserved confounding between the treatment and the outcome.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model.html">make_model</a></span><span class="op">(</span></span>
<span>    <span class="st">"Z -&gt; D -&gt; Y; </span></span>
<span><span class="st">     D &lt;- X -&gt; Y; </span></span>
<span><span class="st">     D &lt;-&gt; Y"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/set_restrictions.html">set_restrictions</a></span><span class="op">(</span><span class="st">"(D[Z=1] &lt; D[Z=0])"</span><span class="op">)</span> </span></code></pre></div>
<p>Relying on the default priors, we update model with the experimental
data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/update_model.html">update_model</a></span><span class="op">(</span><span class="va">df</span>, refresh <span class="op">=</span> <span class="fl">0</span>, iter<span class="op">=</span><span class="fl">4000</span><span class="op">)</span></span></code></pre></div>
<p>To estimate the effect of participation among compliers on
probability of above-median earnings, we use the
<code>query_model</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      LATE<span class="op">=</span><span class="st">"Y[D=1]-Y[D=0] :|: D[Z=1] &gt; D[Z=0]"</span><span class="op">)</span>, </span>
<span>      using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Causal queries generated by query_model (all at population level)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |label |query         |given           |using      | mean|    sd| cred.low| cred.high|</span></span>
<span><span class="co">#&gt; |:-----|:-------------|:---------------|:----------|----:|-----:|--------:|---------:|</span></span>
<span><span class="co">#&gt; |LATE  |Y[D=1]-Y[D=0] |D[Z=1] &gt; D[Z=0] |posteriors | 0.04| 0.015|     0.01|      0.07|</span></span></code></pre></div>
<p>Next, we estimate the share of compliers (<code>co_p</code>),
always-takers (<code>at_p</code>) and never-takers
(<code>nt_p</code>):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      co_p<span class="op">=</span><span class="st">"D[Z=1] &gt; D[Z=0]"</span>, </span>
<span>      at_p<span class="op">=</span><span class="st">"D[Z=1]==1 &amp; D[Z=0]==1"</span>, </span>
<span>      nt_p<span class="op">=</span><span class="st">"D[Z=1]==0 &amp; D[Z=0]==0"</span><span class="op">)</span>, </span>
<span>      using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Causal queries generated by query_model (all at population level)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |label |query                 |using      |  mean|    sd| cred.low| cred.high|</span></span>
<span><span class="co">#&gt; |:-----|:---------------------|:----------|-----:|-----:|--------:|---------:|</span></span>
<span><span class="co">#&gt; |co_p  |D[Z=1] &gt; D[Z=0]       |posteriors | 0.626| 0.006|    0.614|     0.637|</span></span>
<span><span class="co">#&gt; |at_p  |D[Z=1]==1 &amp; D[Z=0]==1 |posteriors | 0.016| 0.002|    0.012|     0.020|</span></span>
<span><span class="co">#&gt; |nt_p  |D[Z=1]==0 &amp; D[Z=0]==0 |posteriors | 0.359| 0.006|    0.348|     0.370|</span></span></code></pre></div>
<p>Observing that most non-compliers are never-takers, we next estimate
the share of men among the compliers (<code>co_mu</code>), always-takers
(<code>at_mu</code>) and never-takers (<code>nt_mu</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/query_model.html">query_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      co_mu<span class="op">=</span><span class="st">"X==1 :|: D[Z=1] &gt; D[Z=0]"</span>, </span>
<span>      at_mu<span class="op">=</span><span class="st">"X==1 :|: D[Z=1]==1 &amp; D[Z=0]==1"</span>,</span>
<span>      nt_mu<span class="op">=</span><span class="st">"X==1 :|: D[Z=1]==0 &amp; D[Z=0]==0"</span><span class="op">)</span>, </span>
<span>      using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Causal queries generated by query_model (all at population level)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |label |query |given                 |using      |  mean|    sd| cred.low| cred.high|</span></span>
<span><span class="co">#&gt; |:-----|:-----|:---------------------|:----------|-----:|-----:|--------:|---------:|</span></span>
<span><span class="co">#&gt; |co_mu |X==1  |D[Z=1] &gt; D[Z=0]       |posteriors | 0.444| 0.007|    0.431|     0.457|</span></span>
<span><span class="co">#&gt; |at_mu |X==1  |D[Z=1]==1 &amp; D[Z=0]==1 |posteriors | 0.364| 0.060|    0.252|     0.485|</span></span>
<span><span class="co">#&gt; |nt_mu |X==1  |D[Z=1]==0 &amp; D[Z=0]==0 |posteriors | 0.479| 0.009|    0.461|     0.496|</span></span></code></pre></div>
<p>The results show that the share of men is larger among the
never-takers compared to the compliers. To obtain the posterior
probability that the share of men among compliers is smaller than among
the never-takers we draw from the posterior distribution via
<code>query_distribution</code> and then compute the share of the draws
for which complier mean is smaller than the never-taker mean:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/query_distribution.html">query_distribution</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      co_mu<span class="op">=</span><span class="st">"X==1 :|: D[Z=1] &gt; D[Z=0]"</span>, </span>
<span>      nt_mu<span class="op">=</span><span class="st">"X==1 :|: D[Z=1]==0 &amp; D[Z=0]==0"</span><span class="op">)</span>, </span>
<span>      using <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"posteriors"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>        pp_co_nt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">co_mu</span> <span class="op">&lt;</span> <span class="va">nt_mu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   pp_co_nt</span></span>
<span><span class="co">#&gt; 1   0.9975</span></span></code></pre></div>
<p>With <code>CausalQueries</code> it is easy to move beyond the
profiling of compliers and non-compliers in fully randomized experiments
as in Marbach and Hangartner (2020). For example, one can extend the
model to allow for conditional random assignment (by adding a causal
arrow from <code>X</code> to <code>Z</code> in the model definition) or
explore how violations of the monotonicity assumption affect the results
(by removing <code><a href="../reference/set_restrictions.html">set_restrictions()</a></code>).</p>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Angrist, J. D., G. W. Imbens, and D. B. Rubin. 1996. “Identification
of Causal Effects Using Instrumental Variables.” <em>Journal of the
American Statistical Association</em> 91.434:444–455.</p>
<p>Bloom, H. S., Orr, L. L., Bell, S. H., Cave, G., Doolittle, F., Lin,
W., and Bos, J. M. 1997. “The benefits and costs of JTPA Title II-A
programs: Key findings from the National Job Training Partnership Act
Study”. <em>The Journal of Human Resources</em> 32.3:549-576.</p>
<p>Marbach, M. and D. Hangartner. 2020. “Profiling compliers and
noncompliers for instrumental-Variable Analysis.” <em>Political
Analysis</em> 28.3:435-444.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Macartan Humphreys, Till Tietz, Alan Jacobs, Lily Medina, Georgiy Syunyaev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
